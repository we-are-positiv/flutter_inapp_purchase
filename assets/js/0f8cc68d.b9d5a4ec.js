"use strict";(self.webpackChunkflutter_inapp_purchase_docs=self.webpackChunkflutter_inapp_purchase_docs||[]).push([[4701],{7066:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>o,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"api/flutter-inapp-purchase","title":"FlutterInappPurchase","description":"The main class for handling in-app purchases across iOS and Android platforms.","source":"@site/versioned_docs/version-6.3/api/flutter-inapp-purchase.md","sourceDirName":"api","slug":"/api/flutter-inapp-purchase","permalink":"/docs/6.3/api/flutter-inapp-purchase","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/flutter_inapp_purchase/tree/main/docs/versioned_docs/version-6.3/api/flutter-inapp-purchase.md","tags":[],"version":"6.3","sidebarPosition":1,"frontMatter":{"title":"FlutterInappPurchase","sidebar_label":"FlutterInappPurchase","sidebar_position":1}}');var i=r(4848),t=r(8453);const c={title:"FlutterInappPurchase",sidebar_label:"FlutterInappPurchase",sidebar_position:1},d="\ud83d\udd27 FlutterInappPurchase API",a={},l=[{value:"\ud83d\udce6 Import",id:"-import",level:2},{value:"\ud83c\udfd7\ufe0f Instance Access",id:"\ufe0f-instance-access",level:2},{value:"\ud83d\udd17 Connection Management",id:"-connection-management",level:2},{value:"initConnection()",id:"initconnection",level:3},{value:"endConnection()",id:"endconnection",level:3},{value:"\ud83d\udecd\ufe0f Product Management",id:"\ufe0f-product-management",level:2},{value:"getProducts()",id:"getproducts",level:3},{value:"getSubscriptions()",id:"getsubscriptions",level:3},{value:"\ud83d\udcb3 Purchase Management",id:"-purchase-management",level:2},{value:"requestPurchase()",id:"requestpurchase",level:3},{value:"requestPurchaseSimple()",id:"requestpurchasesimple",level:3},{value:"\ud83d\udccb Purchase History",id:"-purchase-history",level:2},{value:"getAvailablePurchases()",id:"getavailablepurchases",level:3},{value:"getPurchaseHistory()",id:"getpurchasehistory",level:3},{value:"\u2705 Transaction Completion",id:"-transaction-completion",level:2},{value:"finishTransaction()",id:"finishtransaction",level:3},{value:"\ud83d\udcf1 Platform-Specific Methods",id:"-platform-specific-methods",level:2},{value:"iOS Methods",id:"ios-methods",level:3},{value:"syncIOS()",id:"syncios",level:4},{value:"presentCodeRedemptionSheetIOS()",id:"presentcoderedemptionsheetios",level:4},{value:"showManageSubscriptionsIOS()",id:"showmanagesubscriptionsios",level:4},{value:"Android Methods",id:"android-methods",level:3},{value:"deepLinkToSubscriptionsAndroid()",id:"deeplinktosubscriptionsandroid",level:4},{value:"getConnectionStateAndroid()",id:"getconnectionstateandroid",level:4},{value:"\ud83c\udfa7 Event Streams",id:"-event-streams",level:2},{value:"purchaseUpdated",id:"purchaseupdated",level:3},{value:"purchaseError",id:"purchaseerror",level:3},{value:"\ud83d\udd0d Error Handling",id:"-error-handling",level:2},{value:"\ud83c\udfaf Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcda Related Documentation",id:"-related-documentation",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-flutterinapppurchase-api",children:"\ud83d\udd27 FlutterInappPurchase API"})}),"\n",(0,i.jsx)(n.p,{children:"The main class for handling in-app purchases across iOS and Android platforms."}),"\n",(0,i.jsx)(n.h2,{id:"-import",children:"\ud83d\udce6 Import"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"import 'package:flutter_inapp_purchase/flutter_inapp_purchase.dart';\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-instance-access",children:"\ud83c\udfd7\ufe0f Instance Access"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Access the singleton instance\nfinal iap = FlutterInappPurchase.instance;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-connection-management",children:"\ud83d\udd17 Connection Management"}),"\n",(0,i.jsx)(n.h3,{id:"initconnection",children:"initConnection()"}),"\n",(0,i.jsx)(n.p,{children:"Initialize the connection to the platform billing service."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> initConnection()\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"try {\n  await FlutterInappPurchase.instance.initConnection();\n  print('Connection initialized successfully');\n} catch (e) {\n  print('Failed to initialize connection: $e');\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Platform Notes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"iOS"}),": Calls ",(0,i.jsx)(n.code,{children:"canMakePayments"})," and registers transaction observers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Android"}),": Connects to Google Play Billing service"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"endconnection",children:"endConnection()"}),"\n",(0,i.jsx)(n.p,{children:"End the connection to the platform billing service."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> endConnection()\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"@override\nvoid dispose() {\n  FlutterInappPurchase.instance.endConnection();\n  super.dispose();\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important:"})," Always call this in your app's dispose method to prevent memory leaks."]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-product-management",children:"\ud83d\udecd\ufe0f Product Management"}),"\n",(0,i.jsx)(n.h3,{id:"getproducts",children:"getProducts()"}),"\n",(0,i.jsx)(n.p,{children:"Retrieve a list of consumable and non-consumable products."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<List<IapItem>> getProducts(List<String> productIds)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"productIds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"List<String>"})}),(0,i.jsx)(n.td,{children:"List of product IDs to fetch"})]})})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Future<List<IapItem>>"})," - List of available products"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final products = await FlutterInappPurchase.instance.getProducts([\n  'premium_upgrade',\n  'remove_ads',\n  'extra_lives'\n]);\n\nfor (var product in products) {\n  print('Product: ${product.title} - ${product.localizedPrice}');\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"getsubscriptions",children:"getSubscriptions()"}),"\n",(0,i.jsx)(n.p,{children:"Retrieve a list of subscription products."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<List<IapItem>> getSubscriptions(List<String> subscriptionIds)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"subscriptionIds"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"List<String>"})}),(0,i.jsx)(n.td,{children:"List of subscription IDs to fetch"})]})})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Future<List<IapItem>>"})," - List of available subscriptions"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final subscriptions = await FlutterInappPurchase.instance.getSubscriptions([\n  'monthly_premium',\n  'yearly_premium'\n]);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-purchase-management",children:"\ud83d\udcb3 Purchase Management"}),"\n",(0,i.jsx)(n.h3,{id:"requestpurchase",children:"requestPurchase()"}),"\n",(0,i.jsx)(n.p,{children:"Request a purchase using the new unified API."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> requestPurchase({\n  required RequestPurchase request,\n  required PurchaseType type,\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"request"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RequestPurchase"})}),(0,i.jsx)(n.td,{children:"Platform-specific purchase request"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"type"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseType"})}),(0,i.jsxs)(n.td,{children:["Type of purchase (",(0,i.jsx)(n.code,{children:"inapp"})," or ",(0,i.jsx)(n.code,{children:"subs"}),")"]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"await FlutterInappPurchase.instance.requestPurchase(\n  request: RequestPurchase(\n    ios: RequestPurchaseIosProps(sku: 'premium_upgrade'),\n    android: RequestPurchaseAndroidProps(skus: ['premium_upgrade']),\n  ),\n  type: PurchaseType.inapp,\n);\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"requestpurchasesimple",children:"requestPurchaseSimple()"}),"\n",(0,i.jsx)(n.p,{children:"Simplified purchase request for cross-platform products."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> requestPurchaseSimple({\n  required String productId,\n  required PurchaseType type,\n  String? applicationUsername,\n  String? obfuscatedAccountId,\n  String? obfuscatedProfileId,\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"productId"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"Product ID to purchase"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"type"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseType"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"Purchase type"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"applicationUsername"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String?"})}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"iOS: Application username"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"obfuscatedAccountId"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String?"})}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Android: Obfuscated account ID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"obfuscatedProfileId"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String?"})}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Android: Obfuscated profile ID"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"await FlutterInappPurchase.instance.requestPurchaseSimple(\n  productId: 'premium_upgrade',\n  type: PurchaseType.inapp,\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-purchase-history",children:"\ud83d\udccb Purchase History"}),"\n",(0,i.jsx)(n.h3,{id:"getavailablepurchases",children:"getAvailablePurchases()"}),"\n",(0,i.jsx)(n.p,{children:"Get all non-consumed purchases (restore purchases)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<List<PurchasedItem>?> getAvailablePurchases()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Future<List<PurchasedItem>?>"})," - List of available purchases"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final purchases = await FlutterInappPurchase.instance.getAvailablePurchases();\nif (purchases != null) {\n  for (var purchase in purchases) {\n    print('Purchase: ${purchase.productId}');\n  }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"getpurchasehistory",children:"getPurchaseHistory()"}),"\n",(0,i.jsx)(n.p,{children:"Get purchase history (including consumed purchases on Android)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<List<PurchasedItem>?> getPurchaseHistory()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Future<List<PurchasedItem>?>"})," - List of purchase history"]}),"\n",(0,i.jsx)(n.h2,{id:"-transaction-completion",children:"\u2705 Transaction Completion"}),"\n",(0,i.jsx)(n.h3,{id:"finishtransaction",children:"finishTransaction()"}),"\n",(0,i.jsx)(n.p,{children:"Complete a transaction (cross-platform)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<String?> finishTransaction(PurchasedItem purchase, {bool? isConsumable})\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"purchase"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchasedItem"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"Purchase to finish"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"isConsumable"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool?"})}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Whether the purchase is consumable (Android)"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Listen for purchase updates\nFlutterInappPurchase.purchaseUpdated.listen((purchase) async {\n  if (purchase != null) {\n    // Verify the purchase on your server first\n    await verifyPurchaseOnServer(purchase);\n\n    // Complete the transaction\n    await FlutterInappPurchase.instance.finishTransaction(\n      purchase,\n      isConsumable: true, // for consumable products\n    );\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-platform-specific-methods",children:"\ud83d\udcf1 Platform-Specific Methods"}),"\n",(0,i.jsx)(n.h3,{id:"ios-methods",children:"iOS Methods"}),"\n",(0,i.jsx)(n.h4,{id:"syncios",children:"syncIOS()"}),"\n",(0,i.jsx)(n.p,{children:"Sync pending iOS transactions."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<bool> syncIOS()\n"})}),"\n",(0,i.jsx)(n.h4,{id:"presentcoderedemptionsheetios",children:"presentCodeRedemptionSheetIOS()"}),"\n",(0,i.jsx)(n.p,{children:"Present the code redemption sheet (iOS 14+)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> presentCodeRedemptionSheetIOS()\n"})}),"\n",(0,i.jsx)(n.h4,{id:"showmanagesubscriptionsios",children:"showManageSubscriptionsIOS()"}),"\n",(0,i.jsx)(n.p,{children:"Show the subscription management interface."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> showManageSubscriptionsIOS()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"android-methods",children:"Android Methods"}),"\n",(0,i.jsx)(n.h4,{id:"deeplinktosubscriptionsandroid",children:"deepLinkToSubscriptionsAndroid()"}),"\n",(0,i.jsx)(n.p,{children:"Deep link to subscription management."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<void> deepLinkToSubscriptionsAndroid({String? sku})\n"})}),"\n",(0,i.jsx)(n.h4,{id:"getconnectionstateandroid",children:"getConnectionStateAndroid()"}),"\n",(0,i.jsx)(n.p,{children:"Get the billing client connection state."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Future<BillingClientState> getConnectionStateAndroid()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-event-streams",children:"\ud83c\udfa7 Event Streams"}),"\n",(0,i.jsx)(n.h3,{id:"purchaseupdated",children:"purchaseUpdated"}),"\n",(0,i.jsx)(n.p,{children:"Stream of purchase updates."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Stream<PurchasedItem?> get purchaseUpdated\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"late StreamSubscription _purchaseSubscription;\n\n@override\nvoid initState() {\n  super.initState();\n  _purchaseSubscription = FlutterInappPurchase.purchaseUpdated.listen(\n    (purchase) async {\n      if (purchase != null) {\n        // Handle successful purchase\n        await handlePurchase(purchase);\n      }\n    },\n  );\n}\n\n@override\nvoid dispose() {\n  _purchaseSubscription.cancel();\n  super.dispose();\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"purchaseerror",children:"purchaseError"}),"\n",(0,i.jsx)(n.p,{children:"Stream of purchase errors."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"Stream<PurchaseResult?> get purchaseError\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"FlutterInappPurchase.purchaseError.listen((error) {\n  if (error != null) {\n    print('Purchase error: ${error.message}');\n\n    // Handle specific error codes\n    if (error.code == ErrorCode.eUserCancelled) {\n      // User cancelled - no action needed\n    } else if (error.code == ErrorCode.eNetworkError) {\n      // Show retry option\n      showRetryDialog();\n    }\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-error-handling",children:"\ud83d\udd0d Error Handling"}),"\n",(0,i.jsx)(n.p,{children:"Common error codes you should handle:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Error Code"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Action"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ErrorCode.eUserCancelled"})}),(0,i.jsx)(n.td,{children:"User cancelled purchase"}),(0,i.jsx)(n.td,{children:"No action needed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ErrorCode.eNetworkError"})}),(0,i.jsx)(n.td,{children:"Network error"}),(0,i.jsx)(n.td,{children:"Offer retry"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ErrorCode.eItemUnavailable"})}),(0,i.jsx)(n.td,{children:"Product not available"}),(0,i.jsx)(n.td,{children:"Check product setup"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ErrorCode.eAlreadyOwned"})}),(0,i.jsx)(n.td,{children:"User already owns product"}),(0,i.jsx)(n.td,{children:"Restore or acknowledge"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ErrorCode.eDeveloperError"})}),(0,i.jsx)(n.td,{children:"Configuration error"}),(0,i.jsx)(n.td,{children:"Check setup"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Error Handling:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"FlutterInappPurchase.purchaseError.listen((error) {\n  if (error == null) return;\n\n  switch (error.code) {\n    case ErrorCode.eUserCancelled:\n      // User cancelled - no UI needed\n      break;\n    case ErrorCode.eNetworkError:\n      showSnackBar('Network error. Please check your connection and try again.');\n      break;\n    case ErrorCode.eItemUnavailable:\n      showSnackBar('This item is currently unavailable.');\n      break;\n    case ErrorCode.eAlreadyOwned:\n      showSnackBar('You already own this item.');\n      break;\n    default:\n      showSnackBar('Purchase failed: ${error.message}');\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-best-practices",children:"\ud83c\udfaf Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always initialize connection"})," before making purchases"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle all error cases"})," appropriately"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify purchases server-side"})," before granting content"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Complete transactions"})," after verification"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Clean up streams"})," in dispose methods"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test thoroughly"})," on both platforms"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-related-documentation",children:"\ud83d\udcda Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.a,{href:"/getting-started/installation",children:["\ud83c\udfc1 ",(0,i.jsx)(n.strong,{children:"Getting Started"})]})," - Setup and configuration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.a,{href:"/guides/first-purchase",children:["\ud83d\udcd6 ",(0,i.jsx)(n.strong,{children:"Purchase Guide"})]})," - Step-by-step purchase implementation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.a,{href:"/guides/error-handling",children:["\ud83d\udd0d ",(0,i.jsx)(n.strong,{children:"Error Handling"})]})," - Comprehensive error handling"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.a,{href:"/guides/testing",children:["\ud83e\uddea ",(0,i.jsx)(n.strong,{children:"Testing"})]})," - Testing strategies"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>d});var s=r(6540);const i={},t=s.createContext(i);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);